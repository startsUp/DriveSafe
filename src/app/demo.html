<!DOCTYPE html>
<html>
<head>
    <script src="http://maps.google.com/maps/api/js?sensor=false&libraries=visualization"></script>
    <style>#mapcanvas { height: 885px; width: 100%}
     body { margin:0;}
    </style>
</head>
<body>
<div id="mapcanvas">
    <script type="text/javascript">

        var markers = [];
        var rectangles = [];
        var heatmaps = [];
        var dataPoints = [];

        document.map = new google.maps.Map(document.getElementById("mapcanvas"));
        var latlng = new google.maps.LatLng(38.985012633461345, -77.09705424142618);
        var Options = {
            zoom: 20,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        
        var map = new google.maps.Map(document.getElementById("mapcanvas"), Options);
        map.addListener('click', function(e) {
          placeMarker(e.latLng, map);
          upcall(e.latLng);
        });
       

        var placeMarker = function(latLng, map) {
          var marker = new google.maps.Marker({
            position: latLng,
            animation: google.maps.Animation.DROP,
            map: map
          });
          
          console.log(markers);
          updateOld(marker, null);
        }

        var updateOld = function(marker, map) {
            if (markers.length!=0)
              {
                markers[0].setMap(map);
                markers[0] = marker;
              }
            else
                markers.push(marker); 
        }

        var upcall = function(latlng){
          app.changeLatLong(latlng.toString());
        
        }

        var addDataPoint = function(x, y){
            dataPoints.push(new google.maps.LatLng(x, y));
        }

        var clearDataPoints = function(){
          if(dataPoints.length!=0)
            dataPoints = [];
        }

        var showBox = function(x, y, x2, y2){
          if(rectangles.length==1)
            rectangles[0].setMap(null);

          var rectangle = new google.maps.Rectangle({
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.2,
          map: map,
          bounds: new google.maps.LatLngBounds(new google.maps.LatLng(x,y), 
                  new google.maps.LatLng(x2, y2)),
        });
          rectangles[0] = rectangle;
        }

        var showHeatMap = function(){
          if(rectangles.length==1)
            rectangles[0].setMap(null);
          heatmap = new google.maps.visualization.HeatmapLayer({
                    data: dataPoints,
                    map: map
            });
        }   

       var toggleHeatmap = function() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }

        var clearAllHeatMaps = function() {
          if(heatmaps.length!=0)
          {
            for (var i = 0; i < heatmaps.length; i++) {
              heatmaps[i].setMap(null);
            }
          }
        }
        var drawLine = function (x,y,x1,y1) {
          var line = [{lat: x, lng: y}, {lat: x1, lng: y1}];

          var dLine = new google.maps.Polyline({
          path: line,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
          
        	dLine.setMap(map);
        }

    document.addMarker = function(x, y) {
            var marker = new google.maps.Marker({
            position: new google.maps.LatLng(x, y),
            map: map,
            draggable: false,
            autoPan: true
        });
      
    }
    </script>
</div>
</body>
</html>